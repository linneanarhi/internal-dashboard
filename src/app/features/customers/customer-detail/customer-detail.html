<div class="space-y-4">
  <!-- =======================================================
    Header
  ======================================================== -->
  <header class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
    <div class="flex items-start gap-3">
      <button type="button" class="cursor-pointer" (click)="goBack()" aria-label="Tillbaka">
        <i class="bi bi-arrow-left"></i>
      </button>

      <div>
        <div class="flex items-center gap-2">
          <h1 class="text-sm font-semibold text-ink3">Kunddetaljer</h1>
        </div>
        <span class="text-xl font-bold tracking-tight text-ink">{{ customer?.name ?? 'Okänd kund' }}</span>
      </div>
    </div>

    <!-- Primary actions -->
    <div class="flex flex-wrap gap-2">
      <ng-container *ngIf="customer">
        <button *ngIf="canApproveQuote" type="button" class="btn-accent" (click)="approveQuote()">
          Godkänn offert
        </button>

        <button
          *ngIf="canActivateAgreement"
          type="button"
          class="btn-secondary"
          (click)="goToActivateAgreement()"
        >
          Aktivera avtal
        </button>
      </ng-container>

      <a [routerLink]="['/customers', id, 'add-product']" class="btn-accent">Lägg till produkt</a>
      <a routerLink="/technical-setup" class="btn-secondary">Teknisk uppsättning</a>
    </div>
  </header>

  <!-- Empty state -->
  <section *ngIf="!customer" class="surface p-4 sm:p-6 shadow-soft">
    <div class="text-sm font-semibold text-ink">Kund hittades inte</div>
    <div class="mt-1 text-sm text-ink3">
      Ingen kund med ID: <span class="font-semibold text-ink">{{ id }}</span>
    </div>
  </section>

  <!-- Tabs -->
  <section *ngIf="customer as c" class="card overflow-hidden">
    <nav class="flex flex-wrap gap-2 border-b border-line bg-card p-3" aria-label="Flikar">
      <button
        *ngFor="let t of tabs"
        type="button"
        class="tab"
        [ngClass]="activeTab === t.id ? 'tab-active' : 'tab-idle'"
        (click)="activeTab = t.id"
      >
        {{ t.label }}
      </button>
    </nav>

    <div class="p-4 sm:p-6">
      <!-- Dashboard -->
      <app-customer-dashboard-tab
        *ngIf="activeTab === 'dashboard'"
        [customer]="c"
        [customerId]="id"
        [canApproveQuote]="canApproveQuote"
        [canActivateAgreement]="canActivateAgreement"
        (approveQuote)="approveQuote()"
        (activateAgreement)="goToActivateAgreement()"
        (addProduct)="goToAddProduct()"
        (goTechnicalSetup)="goToTechnicalSetup()"
        (openService)="openService()"
        [statusLabel]="statusLabel(c.stage)"
        [nextAction]="nextActionLabel(c.stage)"
        [isActive]="isActive(c.stage)"
      />

      <!-- Avtal & offerter -->
      <app-customer-agreements-tab
        *ngIf="activeTab === 'agreements'"
        [customer]="c"
        [canApproveQuote]="canApproveQuote"
        [canActivateAgreement]="canActivateAgreement"
        [statusLabel]="statusLabel(c.stage)"
        [nextAction]="nextActionLabel(c.stage)"
        (approveQuote)="approveQuote()"
        (activateAgreement)="goToActivateAgreement()"
      />

      <!-- Datakällor -->
      <app-customer-sources-tab
        *ngIf="activeTab === 'sources'"
        [customer]="c"
        (goTechnicalSetup)="goToTechnicalSetup()"
      />

      <!-- Aktiva användare -->
      <app-customer-users-tab
        *ngIf="activeTab === 'users'"
        [customer]="c"
      />

      <!-- Om kunden -->
      <app-customer-about-tab
        *ngIf="activeTab === 'about'"
        [customer]="c"
      />
    </div>
  </section>
</div>
