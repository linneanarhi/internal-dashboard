<div class="space-y-4">
  <!-- Title + actions -->
  <div class="flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
    <div class="flex items-start gap-3">
      <button type="button" (click)="goBack()" aria-label="Tillbaka" class="cursor-pointer">
        <i class="bi bi-arrow-left"></i>
      </button>

      <div>
        <div class="text-xs text-ink3">
          {{ customer?.name ?? 'Ok√§nd kund' }} [ID: {{ id }}]
        </div>

        <div class="flex items-center gap-2">
          <h1 class="text-xl font-semibold tracking-tight text-ink">Kunddetaljer</h1>

          <!-- Status badge i header -->
          <span
            *ngIf="customer"
            class="inline-flex items-center rounded-full px-2 py-1 text-xs font-medium"
            [ngClass]="statusLabel(customer.stage) === 'Klar'
              ? 'bg-green-100 text-green-700'
              : 'bg-yellow-100 text-yellow-800'"
          >
            {{ statusLabel(customer.stage) }}
          </span>
        </div>

        <!-- N√§sta √•tg√§rd i header -->
        <div *ngIf="customer" class="mt-1 text-xs text-ink3">
          N√§sta steg: <span class="font-medium text-ink">{{ nextActionLabel(customer.stage) }}</span>
        </div>
      </div>
    </div>

    <div class="flex flex-wrap gap-2">
      <!-- Fl√∂desknappar (r√§tt stage => r√§tt knapp) -->
      <button *ngIf="canApproveQuote" class="btn-accent" (click)="approveQuote()">
        Godk√§nn offert
      </button>

      <button *ngIf="canActivateAgreement" class="btn-secondary" (click)="goToActivateAgreement()">
        Aktivera avtal
      </button>

      <a [routerLink]="['/customers', id, 'add-product']" class="btn-accent">
        L√§gg till produkt
      </a>

      <a routerLink="/technical-setup" class="btn-secondary">
        Teknisk upps√§ttning
      </a>
    </div>
  </div>

  <!-- Om kund ej hittas -->
  <div *ngIf="!customer" class="surface p-4 sm:p-6 shadow-soft">
    <div class="text-sm font-semibold text-ink">Kund hittades inte</div>
    <div class="mt-1 text-sm text-ink3">
      Ingen kund med ID: <span class="font-semibold text-ink">{{ id }}</span>
    </div>
  </div>

  <!-- Tabs wrapper (visa bara om kund finns) -->
  <section *ngIf="customer" class="card overflow-hidden">
    <!-- Tabs row -->
    <div class="flex flex-wrap gap-2 border-b border-line bg-card p-3">
      <button
        *ngFor="let t of tabs"
        (click)="activeTab = t.id"
        class="tab"
        [ngClass]="activeTab === t.id ? 'tab-active' : 'tab-idle'"
      >
        {{ t.label }}
      </button>
    </div>

    <!-- Content -->
    <div class="p-4 sm:p-6">
      <!-- Avtal & kontakt -->
      <div *ngIf="activeTab === 'agreement'" class="space-y-4">

        <!-- Fl√∂deskort (tydligt vad som kr√§vs) -->
        <div class="surface p-4 sm:p-6 shadow-soft">
          <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <div class="text-sm font-semibold text-ink">Fl√∂de</div>
              <div class="mt-1 text-sm text-ink3">
                Status:
                <span class="font-semibold text-ink">{{ statusLabel(customer.stage) }}</span>
                ¬∑ N√§sta steg:
                <span class="font-semibold text-ink">{{ nextActionLabel(customer.stage) }}</span>
              </div>
            </div>

            <div class="flex flex-wrap gap-2">
              <button *ngIf="canApproveQuote" class="btn-accent" (click)="approveQuote()">
                Godk√§nn offert
              </button>

              <button *ngIf="canActivateAgreement" class="btn-secondary" (click)="goToActivateAgreement()">
                Aktivera avtal
              </button>
            </div>
          </div>
        </div>

        <!-- Table -->
        <div class="overflow-x-auto rounded-2xl border border-line bg-card">
          <table class="table">
            <thead class="thead bg-[#ffb7004f]">
              <tr>
                <th class="th">Profile</th>
                <th class="th">Name</th>
                <th class="th">Email</th>
                <th class="th">Company ID</th>
                <th class="th">Produkter</th>
              </tr>
            </thead>

            <tbody class="divide-y divide-line2">
              <tr class="row">
                <td class="td">üë§</td>

                <td class="td">
                  <div class="font-semibold text-ink">{{ customer.name }}</div>
                </td>

                <td class="td text-ink2">{{ customer.email }}</td>
                <td class="td text-ink2">{{ customer.companyId }}</td>

                <td class="td">
                  <div class="flex flex-wrap gap-1">
                    <span *ngFor="let p of customer.products" class="pill">
                      {{ labelForProduct(p) }}
                    </span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Mobile actions (placeholder om du vill beh√•lla) -->
        <div class="sm:hidden flex flex-col gap-2">
          <button class="btn-secondary w-full">L√§gg till anv√§ndare</button>
          <button class="btn-primary w-full">Spara √§ndringar</button>
        </div>
      </div>

      <!-- Other tabs placeholder -->
      <div *ngIf="activeTab !== 'agreement'" class="surface p-4 sm:p-6 shadow-soft">
        <div class="text-sm font-semibold text-ink">Inneh√•ll kommer h√§r</div>
        <div class="mt-1 text-sm text-ink3">
          Tab:
          <span class="font-semibold text-ink">{{ activeTab }}</span>
        </div>
      </div>
    </div>
  </section>
</div>
